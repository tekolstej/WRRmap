<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Wind River Sampling Map</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    #map {
      height: 100vh;
    }
    .custom-tooltip {
      background-color: white;
      border: 1px solid #ccc;
      color: black;
      padding: 4px 8px;
      font-size: 12px;
      border-radius: 4px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
    }
  </style>
</head>
<body>
  <div id="map"></div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>

  <script>
    // Initialize map
    const map = L.map('map').setView([42.7, -109.3], 9);

    // Add OpenStreetMap tile layer
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    // Define custom icons
    const icons = {
      'Lodgepole Pine': L.icon({
        iconUrl: 'icons/lp.png',
        iconSize: [32, 37],
        iconAnchor: [16, 37],
        popupAnchor: [0, -37]
      }),
      'Aspen': L.icon({
        iconUrl: 'icons/asp.png',
        iconSize: [32, 37],
        iconAnchor: [16, 37],
        popupAnchor: [0, -37]
      }),
      'Meadow': L.icon({
        iconUrl: 'icons/medo.png',
        iconSize: [32, 37],
        iconAnchor: [16, 37],
        popupAnchor: [0, -37]
      })
    };

    // Load CSV
    fetch('sites1.csv')
      .then(response => response.text())
      .then(csvText => {
        Papa.parse(csvText, {
          header: true,
          skipEmptyLines: true,
          complete: function(results) {
            results.data.forEach(site => {
              const lat = parseFloat(site.latitude);
              const lon = parseFloat(site.longitude);

              if (!isNaN(lat) && !isNaN(lon)) {
                const icon = icons[site.sampled] || L.Icon.Default;

                const popupContent = `
                  <div style="text-align:center; font-weight:bold; font-size:16px; margin-bottom:5px;">
                    ${site.id}
                  </div>
                  <div style="border:1px solid #ccc; padding:6px; margin-bottom:5px; border-radius:5px;">
                    <strong>Site Information</strong><br/>
                    Latitude: ${site.latitude}<br/>
                    Longitude: ${site.longitude}<br/>
                    Elevation: ${site.elevation}
                  </div>
                  <div style="border:1px solid #ccc; padding:6px; border-radius:5px;">
                    <strong>Sample Information</strong><br/>
                    Date: ${site.date}<br/>
                    Time: ${site.time}<br/>
                    Species: ${site.sampled}<br/>
                    CBH: ${site.cbh}<br/>
                    Soil Temp: ${site.soil_temp}<br/>
                    Soil Moisture: ${site.soil_moisture}<br/>
                    Soil pH: ${site.soil_ph}
                  </div>
                `;

                const marker = L.marker([lat, lon], { icon }).addTo(map);
                marker.bindPopup(popupContent);

                // Add hover delay for tooltip
                let hoverTimeout;
                marker.on('mouseover', function () {
                  hoverTimeout = setTimeout(() => {
                    marker.bindTooltip(site.id, {
                      permanent: false,
                      direction: 'top',
                      offset: [0, -20],
                      opacity: 0.9,
                      className: 'custom-tooltip'
                    }).openTooltip();
                  }, 1000); // show after 1 second
                });

                marker.on('mouseout', function () {
                  clearTimeout(hoverTimeout);
                  marker.closeTooltip();
                });
              }
            });
          }
        });
      });
  </script>
</body>
</html>


